<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../../../img/apple-icon.png" />
    <link rel="icon" type="image/png" href="../../../img/favicon.png" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>Material Dashboard by Creative Tim</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0' name='viewport' />
    <meta name="viewport" content="width=device-width" />
    <!-- Bootstrap core CSS     -->
    <link href="../../../css/bootstrap.min.css" rel="stylesheet" />
    <!--  Material Dashboard CSS    -->
    <link href="../../../css/material-dashboard.css?v=1.2.0" rel="stylesheet" />
    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="../../../css/demo.css" rel="stylesheet" />
    <!--     Fonts and icons     -->
    <link href="http://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Roboto:400,700,300|Material+Icons' rel='stylesheet' type='text/css'>
</head>

<body>
    <!--Facebook Account Access Token and Login-->
    <script>
        var accountAccessToken;
        //PAGE ID:  1920099871651923
        //Short Lived Access Token: EAACEdEose0cBAO5dp9JzfQPZAw3wL73kVGGZAnLDiRms0gyVwMzfBASpLr9QmE1ifwZBUHsDI8oaSGZAFlEzyrHDiNhtSqTd3gYkjADwyu3xbZBLH6r3YKACW7KhHoFpHASztNxdxDNqbNUxJZAltkAIZBoXgyKR1EjOUKf8f8XXgfXTZB9SMEhiRvnMjJXipU3rv6dmOpqjsAZDZD
        //https://graph.facebook.com/v2.10/oauth/access_token?grant_type=fb_exchange_token&client_id=899584986866581&client_secret=dd503569702065138c0891beaba6518e&fb_exchange_token=EAACEdEose0cBAO5dp9JzfQPZAw3wL73kVGGZAnLDiRms0gyVwMzfBASpLr9QmE1ifwZBUHsDI8oaSGZAFlEzyrHDiNhtSqTd3gYkjADwyu3xbZBLH6r3YKACW7KhHoFpHASztNxdxDNqbNUxJZAltkAIZBoXgyKR1EjOUKf8f8XXgfXTZB9SMEhiRvnMjJXipU3rv6dmOpqjsAZDZD
        //Long-Lived Access Token: EAAHrM3fVErwBAOrDbYTmOR82tArTUkzC8AI3rDW3ZB6O8fQSSFcTXyC5B3j8sAiNHlBzIlY5hf6I8YhWJGIEx1nZB5ZCaT73W4ZBsgoafEiYX4mdJKXHefy1zKUVTsUent4fj1ZBoWYlKl9rhKjGPfRywdMZAGxuKarWCwZAw2OeAZDZD
        //User ID: https://graph.facebook.com/v2.10/me?access_token=EAAHrM3fVErwBAOrDbYTmOR82tArTUkzC8AI3rDW3ZB6O8fQSSFcTXyC5B3j8sAiNHlBzIlY5hf6I8YhWJGIEx1nZB5ZCaT73W4ZBsgoafEiYX4mdJKXHefy1zKUVTsUent4fj1ZBoWYlKl9rhKjGPfRywdMZAGxuKarWCwZAw2OeAZDZD
        //https://graph.facebook.com/v2.10/391654144618772?fields=access_token&access_token=EAAHrM3fVErwBAOrDbYTmOR82tArTUkzC8AI3rDW3ZB6O8fQSSFcTXyC5B3j8sAiNHlBzIlY5hf6I8YhWJGIEx1nZB5ZCaT73W4ZBsgoafEiYX4mdJKXHefy1zKUVTsUent4fj1ZBoWYlKl9rhKjGPfRywdMZAGxuKarWCwZAw2OeAZDZD
        //Permanent Page Access Token: EAAHrM3fVErwBAObzZBypIwcdgag7wZBD0Ek2bZCS2rbUvRr59efj4zveOrU0fkIxRyDjxlrcDWIDdUXtUrKhhBMWDiRMJWG1ZCcrjwMPUQjdAhSQN6x5wWBFyBPJamsbsIIkxbsJUl0wcpP1ZC2cNhBIUK4xQnbRrKcNb8ZCd4FQZDZD
        window.fbAsyncInit = function() {
            FB.init({
            appId      : '899584986866581',
            autoLogAppEvents: true,
            status: true,
            xfbml      : true,
            version    : 'v2.11'
            });
            FB.AppEvents.logPageView();
    
            
            FB.getLoginStatus(function(response) {
                statusChangeCallback(response);
            });
    
        };
        
        (function(d, s, id){
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) {return;}
            js = d.createElement(s); js.id = id;
            js.src = "https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.11&appId=899584986866581";
            fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));
    
            function statusChangeCallback(response) {
			console.log(response);
            if (response.status === 'connected') {
            console.log('logged in');
            accountAccessToken = response.authResponse.accessToken;
            console.log(accountAccessToken);
            } else {
            console.log ('Not logged in');
            }
            }
    
        // Only works after `FB.init` is called
        function myFacebookLogin() {
            FB.login(function(){}, {scope: 'publish_pages'});
        }


    
        function post() {
            
            if (confirm("Are you sure post this study page on Facebook?") == true) {
                var url = "<% for(var i=0; i<studies.length; i++) {%><%= studies[i].study_teaser_video%><% } %>";
                var videoid = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=|\?v=)([^#\&\?]*).*/);
                var videoSource = "http://i1.ytimg.com/vi/" + videoid[2] + "/default.jpg";
				
				FB.login(function(response) {
				  if (response.status === 'connected') {
					FB.api('/1920099871651923', 'GET', {fields: 'access_token'}, function(response) {
					console.log(response);
					 accountAccessToken = response.access_token;
					FB.api(
					'/1920099871651923/feed',
					'POST',
					{"message":"<% for(var i=0; i<studies.length; i++) {%>  <%= studies[i].study_title%>: <%= studies[i].study_goals%>, <%= studies[i].study_description%> <% } %>",
					//"name": "name",
					"link":"google.com",
					//"link":"http://healthbot.ga/",
					"source": videoSource,
					//"access_token":"https://graph.facebook.com/endpoint?key=value&access_token=540081263022780|c929ccd29ecd8a6eb2a124d949a687b4"},
					"access_token" : accountAccessToken},
					function(response) {
						document.getElementById('status').innerHTML = response.id;
						console.log(response);
					}
					);
					});
				   
					document.getElementById("postEffect").innerHTML = "Post Successfull";
					document.getElementById("postEffect").disabled = true;
				  } else {
					// The person is not logged into this app or we are unable to tell. 
				  }
				});
				
                
            } 
        //FB.api('/page-id/feed', 'post', {message: 'my first status',}, function(response){
            //document.getElementById('status').innerHTML = response.id;
        //});
        }
    </script>

    <div class="wrapper">
        <div class="sidebar" data-color="purple" data-image="../../../img/sidebar-1.jpg">
            <!--
        Tip 1: You can change the color of the sidebar using: data-color="purple | blue | green | orange | red"

        Tip 2: you can also add an image using data-image tag
    -->
            <div class="logo">
                <a href="http://www.creative-tim.com" class="simple-text">
                   Health Bot
                </a>
            </div>
            <div class="sidebar-wrapper">
                <ul class="nav">
                     <li >
                        <a href="<%= host %>user/dashboard/<%= user.id %>">
                            <i class="material-icons">dashboard</i>
                            <p>Dashboard</p>
                        </a>
                    </li>
                    <li>
                        <a href="<%= host %>user/profile/<%= user.id %>">
                            <i class="material-icons">person</i>
                            <p>User Profile</p>
                        </a>
                    </li>
                    <li>
                        <a href="<%= host %>user/<%= user.id %>/study/create">
                            <i class="material-icons">content_paste</i>
                            <p>Add Study</p>
                        </a>
                    </li>
                    <li class="active">
                        <a href="<%= host %>user/<%= user.id %>/study/all">
                            <i class="material-icons">content_paste</i>
                            <p>View Studies</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="main-panel">
            <div class="content">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header" data-background-color="purple">
                                    <h4 class="title">All Studies </h4>
                                </div>
                                <div class="card-content table-responsive">
                                    <table class="table">
                                        <thead class="text-primary">
                                            <th>ID</th>
                                            <th>Title</th>
                                            <th>Description</th>
                                            <th>Link</th>
                                            <th>Post On Facebook</th>
                                        </thead>
                                        <tbody>
                                            <% for(var i=0; i<studies.length; i++) {%>
                                               <tr>
                                                 <td>
                                                   <%= studies[i].id%>
                                                 </td>
                                                 <td>
                                                   <%= studies[i].study_title%>
                                                 </td>
                                                 <td>
                                                   <%= studies[i].study_description%>
                                                 </td>
                                                 <td>
                                                   <a href='<%=host%>study/<%= studies[i].id%>'><button>Study page</button></a>
                                                 </td>
                                                 <td>
                                                    <a href='#'><button onclick="post()" id="postEffect">Post on Facebook</button></a>
                                                 </td>
                                               </tr>
                                            <% } %>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
</body>
<!--   Core JS Files   -->
<script src="../../../js/jquery-3.2.1.min.js" type="text/javascript"></script>
<script src="../../../js/bootstrap.min.js" type="text/javascript"></script>
<script src="../../../js/material.min.js" type="text/javascript"></script>
<!--  Charts Plugin -->
<script src="../../../js/chartist.min.js"></script>
<!--  Dynamic Elements plugin -->
<script src="../../../js/arrive.min.js"></script>
<!--  PerfectScrollbar Library -->
<script src="../../../js/perfect-scrollbar.jquery.min.js"></script>
<!--  Notifications Plugin    -->
<script src="../../../js/bootstrap-notify.js"></script>
<!--  Google Maps Plugin    -->
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
<!-- Material Dashboard javascript methods -->
<script src="../../../js/material-dashboard.js?v=1.2.0"></script>
<!-- Material Dashboard DEMO methods, don't include it in your project! -->
<script src="../../../js/demo.js"></script>

</html>